/* Modified: May 8, 2015, 05:46:39 */
!function(){"use strict";function a(){var a=document.querySelector(".chat-list");a.scrollTop=a.scrollHeight}var b,c,d,e,f=function(){var a=["navy","slate","olive","moss","chocolate","buttercup","maroon","cerise","plum","orchid"];return a[Math.random()*a.length>>>0]},g=function(){var a=["tabby","bengal","persian","mainecoon","ragdoll","sphynx","siamese","korat","japanesebobtail","abyssinian","scottishfold"];return a[Math.random()*a.length>>>0]};d=f(),e=g(),b=d+"-"+e,c="images/"+e+".jpg";var h=document.querySelector("template[is=auto-binding]");h.channel="polymer-chat",h.uuid=b,h.avatar=c,h.color=d,h.checkKey=function(a){(13===a.keyCode||13===a.charCode)&&h.publish()},h.sendMyMessage=function(){h.publish()},h.messageList=[];var i=[],j=[];h.getListWithOnlineStatus=function(a){return[].forEach.call(a,function(a){var b=(a.uuid+"").split("-")[1];a.avatar="images/"+b+".jpg",(void 0===b||/\s/.test(a.uuid))&&(a.uuid="fail-cat",console.log("Oh you, I made this demo open so nice devs can play with, but you are soiling everything :-(")),a.status=j.indexOf(a.uuid)>-1?"online":"offline"}),a},h.displayChatList=function(b){h.messageList=b,h.async(a)},h.subscribeCallback=function(){h.$.sub.messages.length>0&&this.displayChatList(i.concat(this.getListWithOnlineStatus(h.$.sub.messages)))},h.presenceChanged=function(){var a=0,b=h.$.sub.presence.length,c=h.$.sub.presence[b-1];if(h.occupancy=c.occupancy,"join"===c.action)c.uuid.length>35&&(c.uuid="the-mighty-big-cat"),j.push(c.uuid);else{var d=j.indexOf(c.uuid);d>-1&&j.splice(d,1)}a++,h.cats=j,h.messageList.length>0&&(h.messageList=this.getListWithOnlineStatus(h.messageList))},h.historyRetrieved=function(a){a.detail[0].length>0&&(i=this.getListWithOnlineStatus(a.detail[0]),this.displayChatList(i))},h.publish=function(){h.input&&(h.$.pub.message={uuid:b,avatar:c,color:d,text:h.input,timestamp:(new Date).toISOString()},h.$.pub.publish(),h.input="")},h.error=function(a){console.log(a)}}();